%% typography.sty - Typography and Content Macros
%% Heidelberg Catechism Posters

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{typography}[2024/01/01 Illuminated Catechism Typography]

\RequirePackage{fontspec}
\RequirePackage{lettrine}
\RequirePackage{setspace}

%% ============================================================
%% Microtype Configuration - Optical Typography
%% ============================================================

% XeTeX-compatible microtype features:
% - protrusion: optical margin alignment (punctuation hangs into margins)
% Note: expansion, spacing, and kerning require pdfTeX
\RequirePackage[
    protrusion=true,
    expansion=false,
    tracking=false,
    kerning=false,
    spacing=false
]{microtype}

% Protrusion settings for punctuation (optical margins)
% Values are thousandths of an em: {left, right}
\SetProtrusion{encoding={*}, family={*}}{
    {,}={,500},
    {.}={,700},
    {:}={,500},
    {;}={,500},
    {!}={,300},
    {?}={,300},
    {-}={,700},
    {\textendash}={,500},
    {\textemdash}={,300},
    {'}={700,500},
    {"}={500,300},
    {`}={700,},
    {``}={500,},
    {''}={,500},
    {"}={500,300},
    {"}={,500},
    {'}={700,},
    {'}={,700}
}

%% ============================================================
%% Widow/Orphan Control
%% ============================================================

\widowpenalty=10000
\clubpenalty=10000
\brokenpenalty=10000
\predisplaypenalty=10000
\postdisplaypenalty=10000
\displaywidowpenalty=10000
\interlinepenalty=150

%% ============================================================
%% Font Configuration (requires XeLaTeX/LuaLaTeX)
%% ============================================================

% Main body font - EB Garamond for readability with historical character
\setmainfont{EB Garamond}[
    Path=/Users/micahcooper/Library/Application Support/Adobe/CoreSync/plugins/livetype/.r/,
    Extension=.otf,
    UprightFont=.16179,
    ItalicFont=.41000,
    BoldFont=.41005,
    BoldItalicFont=.41006,
    Numbers=OldStyle,
    Ligatures=TeX
]

% Title font - Harbour Decor
\newfontfamily\titlefont{Harbour Decor}[
    Path=/Users/micahcooper/Library/Application Support/Adobe/CoreSync/plugins/livetype/.r/,
    Extension=.otf,
    UprightFont=.58300,
    Scale=1.0
]

% Title shadow font - Harbour Rough
\newfontfamily\titleshadowfont{Harbour Rough}[
    Path=/Users/micahcooper/Library/Application Support/Adobe/CoreSync/plugins/livetype/.r/,
    Extension=.otf,
    UprightFont=.58299,
    Scale=1.0
]

% Header font - EB Garamond small caps
\newfontfamily\headerfont{EB Garamond}[
    Letters=SmallCaps,
    LetterSpace=6,
    Scale=1.0
]

% Small caps font for labels
\newfontfamily\scfont{EB Garamond}[
    Letters=SmallCaps,
    Scale=0.9
]

% Initials font for illuminated drop caps
\newfontfamily\initialsfont{EB Garamond Initials}[
    Scale=1.0
]

% Question text styling
\newcommand{\questiontextfont}{\itshape}

%% ============================================================
%% Drop Cap Configuration
%% ============================================================

\renewcommand{\LettrineTextFont}{}
\setcounter{DefaultLines}{2}

%% ============================================================
%% Content Macros
%% ============================================================

% Question counter
\newcounter{questionnum}

% Counter for uppercase Roman numerals
\newcounter{lordsdaynum}

% Lord's Day header - Title Case with small caps, uppercase Roman
% Usage: \lordsday{1}
\newcommand{\lordsday}[1]{%
    \setcounter{lordsdaynum}{#1}%
    \nopagebreak[4]%
    {\centering\headerfont\fontsize{20pt}{24pt}\selectfont Lord's Day \Roman{lordsdaynum}\par}%
    \nopagebreak[4]%
}

% Question and Answer formatting
% Usage: \catechismqa{1}{Question text}{Answer text}
\newcommand{\catechismqa}[3]{%
    \setcounter{questionnum}{#1}%
    \par\vspace*{0.35em}%
    \nopagebreak[4]%
    % Question number and bold text, 4pt larger than body
    \noindent{\textcolor{gold}{\bfseries #1.}\hspace{0.3em}}%
    {\fontsize{24pt}{28pt}\selectfont\bfseries #2}%
    \par\vspace{0.15em}%
    \nopagebreak[3]%
    % Answer
    \noindent #3%
    \par%
}

% Scripture reference formatting
\newcommand{\scripture}[1]{%
    {\footnotesize\itshape #1}%
}

% Section divider (simple)
\newcommand{\sectiondivider}{%
    \vspace{0.5em}%
    \begin{center}%
        \rule{2in}{0.4pt}%
    \end{center}%
    \vspace{0.5em}%
}

%% ============================================================
%% Text Spacing for Large Format
%% ============================================================

% Generous line spacing for poster readability
\setstretch{1.15}

% Paragraph settings
\setlength{\parindent}{0em}
\setlength{\parskip}{0.2em plus 0.1em minus 0.05em}

\endinput
